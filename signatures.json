{
  "eval_function": {
    "regex": "(?i)\\beval\\s*\\(",
    "weight": 5,
    "category": "Code Execution",
    "severity": "High",
    "description": "Detects use of eval(), which executes arbitrary PHP code. Often used in injected or obfuscated malware payloads.",
    "reference": "https://www.php.net/manual/en/function.eval.php"
  },
  "assert_function": {
    "regex": "(?i)\\bassert\\s*\\(",
    "weight": 4,
    "category": "Code Execution",
    "severity": "High",
    "description": "Detects assert() usage that can execute arbitrary code when used with dynamic input.",
    "reference": "https://owasp.org/www-community/attacks/Code_Injection"
  },
  "error_suppression_eval": {
    "regex": "@eval\\s*\\(",
    "weight": 5,
    "category": "Code Execution",
    "severity": "High",
    "description": "Eval wrapped with error suppression, a typical signature of concealed PHP malware."
  },
  "variable_eval_chain": {
    "regex": "\\$[a-zA-Z_][a-zA-Z0-9_]*\\s*=\\s*['\"]?base64_decode",
    "weight": 4,
    "category": "Obfuscation",
    "severity": "High",
    "description": "Encoded variable assignment that decodes and executes hidden payloads."
  },
  "base64_decode": {
    "regex": "(?i)base64_decode\\s*\\(",
    "weight": 3,
    "category": "Obfuscation",
    "severity": "Medium",
    "description": "Base64 decoding frequently appears in encoded backdoors and hidden code blocks."
  },
  "rot13_chain": {
    "regex": "(str_rot13\\s*\\(.*base64_decode|base64_decode\\s*\\(.*str_rot13)",
    "weight": 4,
    "category": "Obfuscation",
    "severity": "High",
    "description": "ROT13 + base64 decoding chain, a classic obfuscation technique for PHP malware."
  },
  "compressed_payload": {
    "regex": "(gzinflate|gzuncompress|gzdecode)\\s*\\(",
    "weight": 4,
    "category": "Obfuscation",
    "severity": "Medium",
    "description": "Compressed payload decoding, often used alongside base64_decode for packed malware."
  },
  "xor_obfuscation": {
    "regex": "\\$[A-Za-z0-9_]+\\s*\\^\\s*['\"]",
    "weight": 4,
    "category": "Obfuscation",
    "severity": "High",
    "description": "XOR operations on string literals are a hallmark of XOR-encrypted PHP malware."
  },
  "dynamic_variable_exec": {
    "regex": "\\${\\$_(GET|POST|REQUEST)\\[",
    "weight": 5,
    "category": "Dynamic Execution",
    "severity": "High",
    "description": "Dynamic variable creation from user input; frequently used in backdoors and remote shells."
  },
  "hidden_php_tag": {
    "regex": "<\\?(?:php)?\\s*@?eval|<\\?=\\s*@?eval",
    "weight": 5,
    "category": "Injection / Backdoor",
    "severity": "High",
    "description": "Hidden PHP opening tag combined with eval(), common in injected payloads."
  },
  "include_wrapper": {
    "regex": "(include|require)(_once)?\\s*\\(\\s*\\$\\_",
    "weight": 5,
    "category": "Remote Inclusion",
    "severity": "High",
    "description": "Inclusion of files using user input — typical of RFI vulnerabilities."
  },
  "remote_url_include": {
    "regex": "(include|require)(_once)?\\s*\\(['\"]https?://",
    "weight": 5,
    "category": "Remote Inclusion",
    "severity": "High",
    "description": "Direct remote include of PHP code via HTTP/HTTPS; highly dangerous."
  },
  "function_overloading": {
    "regex": "function\\s+\\w+\\s*\\(.*\\)\\s*\\{[^}]*\\b(eval|exec|system)\\b",
    "weight": 4,
    "category": "Backdoor",
    "severity": "High",
    "description": "Function wrappers that hide command execution calls."
  },
  "ua_backdoor": {
    "regex": "\\$_SERVER\\['HTTP_USER_AGENT'\\]\\s*==",
    "weight": 4,
    "category": "Conditional Backdoor",
    "severity": "High",
    "description": "Backdoor triggered via specific User-Agent string."
  },
  "password_backdoor": {
    "regex": "\\$_(GET|POST|REQUEST)\\[['\"](pass|pwd|key)['\"]\\]",
    "weight": 5,
    "category": "Backdoor",
    "severity": "High",
    "description": "Password-activated web shell triggers common in PHP backdoors."
  },
  "function_assert_chain": {
    "regex": "(eval|assert)\\s*\\(\\s*base64_decode",
    "weight": 5,
    "category": "Backdoor",
    "severity": "High",
    "description": "Encoded payloads executed directly using eval/assert."
  },
  "file_put_contents_dropper": {
    "regex": "file_put_contents\\s*\\(.*base64_decode",
    "weight": 4,
    "category": "Dropper",
    "severity": "High",
    "description": "Writes decoded malware payloads to disk — a strong indicator of active infection."
  },
  "wordpress_fake_plugin": {
    "regex": "Plugin Name:\\s*(Backdoor|WSO|FilesMan|IndoXploit|b374k)",
    "weight": 4,
    "category": "WordPress Exploit",
    "severity": "High",
    "description": "Fake plugin header used by web shells disguised as legitimate plugins."
  },
  "wordpress_unauth_ajax": {
    "regex": "add_action\\s*\\(\\s*['\"]wp_ajax_nopriv_",
    "weight": 3,
    "category": "WordPress Exploit",
    "severity": "Medium",
    "description": "AJAX endpoint for unauthenticated users — can be abused to trigger code remotely."
  },
  "malicious_wp_option": {
    "regex": "update_option\\s*\\(\\s*['\"](siteurl|home)['\"]",
    "weight": 3,
    "category": "WordPress Exploit",
    "severity": "Medium",
    "description": "Pharma or redirect hacks modifying WordPress URL settings."
  },
  "email_spammer": {
    "regex": "\\$headers\\s*=\\s*['\"].*\\bContent-Type: text/html",
    "weight": 2,
    "category": "Spam / Mailer",
    "severity": "Medium",
    "description": "Mailer script creating headers for mass mailing or phishing."
  },
  "hidden_iframe_injection": {
    "regex": "<iframe[^>]+(display\\s*:\\s*none|width=\\\"0\\\"|height=\\\"0\\\")",
    "weight": 3,
    "category": "HTML Injection",
    "severity": "Medium",
    "description": "Invisible iframe used for redirects, tracking, or hidden script loading."
  },
  "js_unpacker_payload": {
    "regex": "eval\\s*\\(\\s*function\\s*\\(.*\\)\\s*\\{",
    "weight": 3,
    "category": "JavaScript Injection",
    "severity": "Medium",
    "description": "Self-executing JS functions used to unpack obfuscated payloads."
  },
  "seo_spam_link": {
    "regex": "<a\\s+href=['\"]https?://[^'\"]*(viagra|casino|porn|dating)",
    "weight": 2,
    "category": "SEO Spam",
    "severity": "Low",
    "description": "Injected spam links in compromised WordPress posts or templates."
  },
  "php_shell_fingerprint": {
    "regex": "(FilesMan|WSO|r57|c99|b374k|IndoXploit|AlfaShell|Symlink|Weevely)",
    "weight": 6,
    "category": "Web Shell Signature",
    "severity": "Critical",
    "description": "Known PHP shell code fragments detected; immediate high-risk indicator."
  },
  "self_delete": {
    "regex": "unlink\\s*\\(__FILE__\\)",
    "weight": 4,
    "category": "Persistence",
    "severity": "Medium",
    "description": "Malware self-deletion used to hide traces after execution."
  },
  "disable_logs": {
    "regex": "ini_set\\s*\\(\\s*['\"]error_log['\"],\\s*['\"]?['\"]?\\)",
    "weight": 2,
    "category": "Evasion",
    "severity": "Low",
    "description": "Disabling PHP error logs to hide execution traces."
  },
  "temp_file_payload": {
    "regex": "sys_get_temp_dir\\s*\\(\\).*file_put_contents",
    "weight": 3,
    "category": "Dropper",
    "severity": "Medium",
    "description": "Temporary file creation for payloads or shell scripts."
  },
  "reverse_shell": {
    "regex": "(bash -i >& /dev/tcp|nc -e /bin/sh|php -r .*fsockopen)",
    "weight": 6,
    "category": "Command Execution",
    "severity": "Critical",
    "description": "Reverse shell pattern detected — full remote code execution."
  }
  "php_in_nonphp_file": {
    "regex": "<\\?php",
    "weight": 5,
    "category": "Embedded PHP",
    "severity": "High",
    "description": "Detects PHP opening tag in files that are not expected to contain PHP (images, uploads, templates). Frequently indicates a dropped webshell.",
    "reference": "https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload"
  },
  "large_base64_blob": {
    "regex": "[A-Za-z0-9+/]{200,}={0,2}",
    "weight": 4,
    "category": "Obfuscation",
    "severity": "High",
    "description": "Large contiguous base64 block. Legitimate in some cases, but commonly used to carry encoded payloads or exfiltrated data.",
    "reference": "https://owasp.org/www-community/attacks/Code_Injection"
  },
  "known_webshell_filenames": {
    "regex": "(?:shell|wso|b374k|c99|r57|phpseclib|filesman|phpspy)\\.(?:php|phtml|inc)$",
    "weight": 5,
    "category": "Web Shell Signature",
    "severity": "High",
    "description": "Common web shell filenames and variants. Matches common malicious filenames dropped by attackers."
  },
  "php_in_uploads_path": {
    "regex": "wp-content/uploads/.*\\.(?:php|phtml|phar|inc)",
    "weight": 5,
    "category": "File Upload Abuse",
    "severity": "High",
    "description": "PHP files located in uploads path. Strong indicator of uploaded webshells or dropped payloads.",
    "reference": "https://owasp.org/www-community/attacks/Unrestricted_File_Upload"
  },
  "serialized_object_injection": {
    "regex": "O:\\d+:\"[A-Za-z0-9_\\\\]+\":\\d+:\\{",
    "weight": 4,
    "category": "Object Injection",
    "severity": "High",
    "description": "PHP serialized object pattern (O:...). Can indicate gadget chains or unsafe unserialise usage leading to RCE.",
    "reference": "https://owasp.org/www-community/vulnerabilities/PHP_Object_Injection"
  },
  "suspicious_userini_disable": {
    "regex": "\\.user\\.ini|ini_set\\s*\\(\\s*['\\\"]disable_functions['\\\"]",
    "weight": 3,
    "category": "Evasion",
    "severity": "Medium",
    "description": "Changes to disable_functions or presence of .user.ini may be used to evade platform protections.",
    "reference": "https://www.php.net/manual/en/ini.core.php"
  },
  "htaccess_rewrites_pharma": {
    "regex": "RewriteRule\\s+.*(google|bing|yahoo|checkout|paypal|account|wp-login)\\b",
    "weight": 3,
    "category": "Redirect / Pharma",
    "severity": "High",
    "description": "Rewrite rules altering or redirecting traffic to suspicious keywords (pharma/checkout/password pages). Often used in SEO/pharma compromises.",
    "reference": "https://www.sucuri.net/guides/"
  },
  "suspicious_cron_php_exec": {
    "regex": "(?:crontab|cron).*\\bphp\\b.*(wget|curl|php)\\s",
    "weight": 4,
    "category": "Persistence",
    "severity": "High",
    "description": "Cron lines invoking PHP or remote fetches. Attackers often schedule persistence tasks using cron.",
    "reference": "https://attack.mitre.org/techniques/T1053/"
  },
  "suspicious_js_minified_singleline": {
    "regex": "<script[^>]*>[^\\n]{2000,}</script>",
    "weight": 3,
    "category": "JS Obfuscation",
    "severity": "Medium",
    "description": "Very large single-line inline script blocks (minified/obfuscated). Common in malvertising and crypto-miners.",
    "reference": "https://owasp.org/www-community/attacks/Code_Injection"
  },
  "suspicious_function_wrappers": {
    "regex": "\\$\\_\\w+\\s*=\\s*base64_decode\\(|preg_replace\\s*\\(.*?/e|create_function\\s*\\(",
    "weight": 4,
    "category": "Obfuscation / Execution",
    "severity": "High",
    "description": "Chains of functions and wrappers used to unpack and execute payloads; flags typical obfuscation+execution patterns."
  },
  "suspicious_htaccess_php_flags": {
    "regex": "AddHandler\\s+application/x-httpd-php|SetHandler\\s+php-script",
    "weight": 3,
    "category": "Server Config",
    "severity": "Medium",
    "description": ".htaccess or config that forces PHP parsing in non-php directories (uploads). May be used to run uploaded PHP.",
    "reference": "https://httpd.apache.org/docs/"
  },
  "composer_auto_prepend": {
    "regex": "auto_prepend_file\\s*=|ComposerAutoloadInit",
    "weight": 3,
    "category": "Supply Chain / Autoload",
    "severity": "Medium",
    "description": "Signs of autoload or auto_prepend manipulation. Attacker may persist code via autoload or prepend hooks.",
    "reference": "https://getcomposer.org/doc/01-basic-usage.md"
  }
}
